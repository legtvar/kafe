# What do you mean `x64 v2`?

I've taken on fixing our observability setup, which got mysteriously busted when after almost a year I updated every
container to their latest version.
One of the issues I've encountered is the `tempo` container failing to launch with the following message:

```
...
This program can only be run on AMD64 processors with v2 microarchitecture support.
This program can only be run on AMD64 processors with v2 microarchitecture support.
This program can only be run on AMD64 processors with v2 microarchitecture support.
This program can only be run on AMD64 processors with v2 microarchitecture support.
```

What do you know, there's more than one x86-64 (i.e. AMD64 or just x64).
There's actually four [microarchitecture levels] of x64.
And Tempo's compilation target simply changed to v2 at some point.
So the real question was: Why are we at v1? Stratus' CPUs are certainly not that old, right?
True. But Stratus's (or rather likely OpenNebula's) CPU model, which is the CPU that the VM should mimick,
is set to `qemu64`, which only supports microarchitecture v1.

So in the end the solution was fairly straightforward.
First, I set the CPU model to `passthrough`, so that I could check what CPU the host actually has.
Then, I set it to `EPYC Milan` as that is the closest model I could find in Stratus's dropdown menu.
This way, the VM should be still relatively migratable, while supporting the v2 (and v3) x64 microarchitectures.

Unfortunately, our observability setup is still broken so there must be some other issue as well. :/
More on that once I fix it.


[microarchitecture levels]: https://en.wikipedia.org/wiki/X86-64#Microarchitecture_levels
